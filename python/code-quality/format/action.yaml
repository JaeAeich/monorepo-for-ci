---
name: Format Code
description: Checks and ensures the code is formatted according to the defined style guidelines.

inputs:
  os:
    description: OS to use
    default: "ubuntu-latest"
  python_version:
    description: Python version to use
    default: "3.12"
    required: false
  poetry_install_options:
    description: Options for installing dependencies via poetry
    required: false
    default: "--only=code_quality --no-root"
  poetry_export_options:
    description: Options for exporting dependencies to check for hash 
      changes for cache invalidation
    required: false
    default: "--only=code_quality"
  github_token:
    description: GitHub token for authentication
    required: true

runs:
  using: composite
  steps:
    - name: Check out repository
      uses: actions/checkout@v4

    - name: Set up environment
      uses: jaeaeich/monorepo-for-ci/python/setup/poetry@main
      with:
        os: ${{ inputs.os }}
        python_version: ${{ inputs.python_version }}
        poetry_install_options: ${{ inputs.poetry_install_options }}
        poetry_export_options: ${{ inputs.poetry_export_options }}

    - name: Check code style
      shell: bash
      run: poetry run ruff format --check

    - name: Comment on Failure
      if: ${{ failure() }}
      uses: peter-evans/create-or-update-comment@v3
      with:
        token: ${{ inputs.github_token }}
        issue-number: ${{ github.event.pull_request.number }}
        body: |
          :x: **Code Style Check Failed**

          Hi @${{ github.event.pull_request.user.login }},

          Your pull request **${{ github.event.pull_request.title }}** has failed the code style check on **${{ inputs.os }}** with Python **${{ inputs.python_version }}**. 

          :point_right: Please address the issues to ensure consistency and adherence to the project's coding standards. You can follow the [code style guide](<link-to-docs>) to fix these issues.

          :bulb: **Need help?** You can tag the maintainers by commenting `@maintainer-username` in this thread for assistance.

          <details>
          <summary> :gear: <strong>Environment Details (click to expand)</strong> </summary>

          - **Workflow**: ${{ github.workflow }}
          - **Job Name**: ${{ github.job }}
          - **Run ID**: ${{ github.run_id }}
          - **Run Number**: ${{ github.run_number }}
          - **Triggered by**: ${{ github.event_name }}
          - **Commit Message**: ${{ github.event.head_commit.message }}
          - **Commit SHA**: `${{ github.sha }}`
          - **Branch**: `${{ github.ref }}`

          **Environment Details:**
          - **Operating System**: `${{ inputs.os }}`
          - **Python Version**: `${{ inputs.python_version }}`
          - **Poetry Install Options**: `${{ inputs.poetry_install_options }}`
          - **Poetry Export Options**: `${{ inputs.poetry_export_options }}`

          </details>

          :page_with_curl: You can review the full workflow logs for more information: [View Logs](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}).

          :wave: **Happy Coding!** If you need any assistance, don't hesitate to reach out.
...
